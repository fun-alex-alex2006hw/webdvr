// EXAMPLE LISTING RESULT:
// http://www.antennaweb.org/Stations.aspx/GetAntennaPredictions
// {"d":{"__type":"AntennaWeb.AntennaPredictor.AntennaRecommendationReturn","ErrorCode":0,"ErrorMessage":"OK","Stations":[{"network_logo":"FOX_Light.png","Networks":"FOX|","call_sign":"KASA-DT","rf_channel":27,"parent_call_sign":"KASA-DT","network":"FOX","signal_strength":89.2318311595773,"broadcast_type":1,"city":"SANTA FE","state":"NM","antenna_type":0,"distance":22.217710102267965,"direction_magnetic":74.700613947473428,"direction_true":84.712428064905069,"station_id":5606,"psip_channel":"2.1","antenna_color":0,"live_date":" ","live_status":1},{"network_logo":"MyNet_All.png","Networks":"MYNET|","call_sign":"KASY-DT","rf_channel":45,"parent_call_sign":"KASY-DT","network":"MNT","signal_strength":85.4064825326681,"broadcast_type":1,"city":"ALBUQUERQUE","state":"NM","antenna_type":0,"distance":22.237378705720282,"direction_magnetic":74.864888354525888,"direction_true":84.876702471957529,"station_id":5612,"psip_channel":"50.1","antenna_color":0,"live_date":" ","live_status":1},{"network_logo":"IND_All.png","Networks":"IND|GODTV|","call_sign":"KAZQ-DT","rf_channel":17,"parent_call_sign":"KAZQ-DT","network":"IND","signal_strength":77.049549042892366,"broadcast_type":1,"city":"ALBUQUERQUE","state":"NM","antenna_type":0,"distance":22.220501508621986,"direction_magnetic":74.621316954047515,"direction_true":84.633131071479156,"station_id":5641,"psip_channel":"32.1","antenna_color":0,"live_date":" ","live_status":2},{"network_logo":"IND_All.png","Networks":"IND|FMN|HEARTLAND|ATV|","call_sign":"KCHF-DT","rf_channel":10,"parent_call_sign":"KCHF-DT","network":"FMN","signal_strength":68.174417138344339,"broadcast_type":1,"city":"SANTA FE","state":"NM","antenna_type":0,"distance":66.72524998219609,"direction_magnetic":3.0940518748694164,"direction_true":13.105865992301057,"station_id":5387,"psip_channel":"11.1","antenna_color":0,"live_date":" ","live_status":4},{"network_logo":"Univision_All.png","Networks":"UNIVIS|LA-TV|","call_sign":"KLUZ-DT","rf_channel":42,"parent_call_sign":"KLUZ-DT","network":"UNI","signal_strength":83.363787298732646,"broadcast_type":1,"city":"ALBUQUERQUE","state":"NM","antenna_type":0,"distance":22.320288671856844,"direction_magnetic":75.440110696290176,"direction_true":85.451924813721817,"station_id":4797,"psip_channel":"41.1","antenna_color":0,"live_date":" ","live_status":2},{"network_logo":"TBN_Light.png","Networks":"TBN|CHURCHCHAN|JUCETV|TBNENL|SMILE|","call_sign":"KNAT-DT","rf_channel":24,"parent_call_sign":"KNAT-DT","network":"TBN","signal_strength":88.458904231537758,"broadcast_type":1,"city":"ALBUQUERQUE","state":"NM","antenna_type":0,"distance":22.277381482039349,"direction_magnetic":75.033268594493379,"direction_true":85.045082711925019,"station_id":4495,"psip_channel":"23.1","antenna_color":0,"live_date":" ","live_status":5},{"network_logo":"World_Light.png","Networks":"WORLD|CREATE|","call_sign":"KNMD-DT","rf_channel":8,"parent_call_sign":"KNMD-DT","network":"PBS","signal_strength":70.569744391430589,"broadcast_type":1,"city":"SANTA FE","state":"NM","antenna_type":0,"distance":22.302452716586945,"direction_magnetic":75.197857143165223,"direction_true":85.209671260596863,"station_id":74296,"psip_channel":"9.1","antenna_color":0,"live_date":" ","live_status":2},{"network_logo":"PBS_Light.png","Networks":"PBS|V-ME|","call_sign":"KNME-DT","rf_channel":35,"parent_call_sign":"KNME-DT","network":"PBS","signal_strength":87.415971574723926,"broadcast_type":1,"city":"ALBUQUERQUE","state":"NM","antenna_type":0,"distance":22.214962244759995,"direction_magnetic":74.7799021616418,"direction_true":84.791716279073441,"station_id":4523,"psip_channel":"5.1","antenna_color":0,"live_date":" ","live_status":2},{"network_logo":"IND_All.png","Networks":"IND|","call_sign":"KNMQ-LD","rf_channel":43,"parent_call_sign":"KNMQ-LD","network":"IND","signal_strength":74.807869446963963,"broadcast_type":1,"city":"ALBUQUERQUE","state":"NM","antenna_type":0,"distance":22.207569791709748,"direction_magnetic":74.418239250530092,"direction_true":84.430053367961733,"station_id":96319,"psip_channel":"43.1","antenna_color":0,"live_date":" ","live_status":2},{"network_logo":"ABC_All.png","Networks":"ABC|ESTRTV|","call_sign":"KOAT-DT","rf_channel":7,"parent_call_sign":"KOAT-DT","network":"ABC","signal_strength":76.344129496473926,"broadcast_type":1,"city":"ALBUQUERQUE","state":"NM","antenna_type":0,"distance":22.226211957795471,"direction_magnetic":74.462783479833263,"direction_true":84.4745975972649,"station_id":4566,"psip_channel":"7.1","antenna_color":0,"live_date":" ","live_status":2},{"network_logo":"NBC_All.png","Networks":"NBC|THISTV|","call_sign":"KOB-DT","rf_channel":26,"parent_call_sign":"KOB-DT","network":"NBC","signal_strength":87.7254116948019,"broadcast_type":1,"city":"ALBUQUERQUE","state":"NM","antenna_type":0,"distance":22.27238189833886,"direction_magnetic":75.350939229955273,"direction_true":85.362753347386914,"station_id":4568,"psip_channel":"4.1","antenna_color":0,"live_date":" ","live_status":2},{"network_logo":"CBS_Light.png","Networks":"CBS|","call_sign":"KRQE-DT","rf_channel":13,"parent_call_sign":"KRQE-DT","network":"CBS","signal_strength":76.778502828670142,"broadcast_type":1,"city":"ALBUQUERQUE","state":"NM","antenna_type":0,"distance":22.292782288008112,"direction_magnetic":75.5142252529675,"direction_true":85.526039370399147,"station_id":4418,"psip_channel":"13.1","antenna_color":0,"live_date":" ","live_status":1},{"network_logo":"Univision_All.png","Networks":"UNIMAS|","call_sign":"KTFQ-DT","rf_channel":22,"parent_call_sign":"KTFQ-DT","network":"TFA","signal_strength":92.599265097339625,"broadcast_type":1,"city":"ALBUQUERQUE","state":"NM","antenna_type":0,"distance":24.235827114871924,"direction_magnetic":343.19269535145486,"direction_true":353.2045094688865,"station_id":5594,"psip_channel":"14.1","antenna_color":0,"live_date":" ","live_status":1},{"network_logo":"CW_All.png","Networks":"CW|","call_sign":"KWBQ-DT","rf_channel":29,"parent_call_sign":"KWBQ-DT","network":"CW","signal_strength":87.293137208745534,"broadcast_type":1,"city":"SANTA FE","state":"NM","antenna_type":0,"distance":22.302452716586945,"direction_magnetic":75.197857143165223,"direction_true":85.209671260596863,"station_id":3705,"psip_channel":"19.1","antenna_color":0,"live_date":" ","live_status":1},{"network_logo":"Telemundo_Light.png","Networks":"TELEMUND|","call_sign":"KTEL-LP","rf_channel":47,"parent_call_sign":"KTEL-LP","network":"TEL","signal_strength":93.09863902803437,"broadcast_type":0,"city":"ALBUQUERQUE","state":"NM","antenna_type":1,"distance":22.195379546534387,"direction_magnetic":74.615384807122254,"direction_true":84.6271989245539,"station_id":6789,"psip_channel":"","antenna_color":1,"live_date":"Under Review","live_status":1},{"network_logo":null,"Networks":"","call_sign":"KTVS-LD","rf_channel":36,"parent_call_sign":"KTVS-LD","network":"REL","signal_strength":70.6418846189365,"broadcast_type":1,"city":"ALBUQUERQUE","state":"NM","antenna_type":1,"distance":22.220501508621986,"direction_magnetic":74.621316954047515,"direction_true":84.633131071479156,"station_id":85432,"psip_channel":"36.1","antenna_color":1,"live_date":" ","live_status":0},{"network_logo":"MeTV_All.png","Networks":"METV|","call_sign":"KRTN-LD","rf_channel":39,"parent_call_sign":"KRTN-LD","network":"RTN","signal_strength":68.492493614803891,"broadcast_type":1,"city":"ALBUQUERQUE","state":"NM","antenna_type":3,"distance":22.195379546534387,"direction_magnetic":74.615384807122254,"direction_true":84.6271989245539,"station_id":84828,"psip_channel":"33.1","antenna_color":3,"live_date":" ","live_status":1},{"network_logo":null,"Networks":"","call_sign":"K46GY","rf_channel":46,"parent_call_sign":"KTEL-DT","network":"TEL","signal_strength":65.819760374335146,"broadcast_type":0,"city":"CARLSBAD","state":"NM","antenna_type":4,"distance":22.195379546534387,"direction_magnetic":74.615384807122254,"direction_true":84.6271989245539,"station_id":7241,"psip_channel":"","antenna_color":4,"live_date":"Under Review","live_status":0},{"network_logo":"AztecaAmerica_Light.png","Networks":"AZTECA|","call_sign":"KQDF-LP","rf_channel":25,"parent_call_sign":"KQDF-LP","network":"AZA","signal_strength":69.552133499233435,"broadcast_type":0,"city":"ALBUQUERQUE","state":"NM","antenna_type":4,"distance":16.153175231269653,"direction_magnetic":198.79010075702331,"direction_true":208.80191487445495,"station_id":7932,"psip_channel":"","antenna_color":4,"live_date":"","live_status":1}]}}
// Basically I should be able to do a JSON request from this address with that data, and it should work.

        function getAntennaPredictions(updateBounds) {
            //update the hidden fields so the cookie can be updated.                      
            $("#loading").fadeIn();

            var obstructed = "False";
            var serviceCall = {
                type: "POST",
                url: www.antennaweb.org/Stations.aspx + "/GetAntennaPredictions",
                data: '{"latitude":' + currentAddress.location.lat() + ',"longitude":' + currentAddress.location.lng() + ',"height":' + currentAddress.receiveHeight + ',"obstructed":' + obstructed + '}',
                contentType: "application/json; charset=utf-8",
                dataType: "json",
                success: function (data, textStatus, jqXHR) {

                    var awr = new Array();
                    $(data.d.Stations).each(function () {

                        var callSign = this.call_sign;
                        var color = this.antenna_color;
                        var rfChannel = this.rf_channel;
                        var psipChannel = this.psip_channel;
                        var channel = psipChannel;
                        if (channel.length == 0)
                            channel = this.rf_channel;
                        var band = "vhf";
                        if (parseInt(rfChannel) > 13)
                            band = "uhf";
                        var network = this.network;
                        var directionTrue = this.direction_true;
                        var distance = this.distance;
                        var stationId = this.station_id;
                        var signalStrength = this.signal_strength;
                        var broadcastType = this.broadcast_type;
                        var city = this.city;
                        var state = this.state;
                        var antennaType = this.antenna_type;
                        var directionMagnetic = this.direction_magnetic;
                        var liveDate = this.live_date;
                        var liveStatus = this.live_status;
                        var networkLogo = this.network_logo;
                        var x = {
                            band: band, psip_channel: psipChannel, rf_channel: rfChannel, live_status: liveStatus, live_date: liveDate, network_logo: networkLogo, direction_magnetic: directionMagnetic,
                            antenna_type: antennaType, state: state, city: city, call_sign: callSign, color: color, channel: channel, network: network, direction_true: directionTrue,
                            distance: distance, signal_strength: signalStrength, broadcast_type: broadcastType, station_id: stationId
                        };
                        awr.push(x);
                    });

                    currentAddress.antennawebResults = awr;
                    Render(updateBounds);

                    $("#loading").fadeOut();

                },
                error: function (msg) {
                    // TODO: alert the user somehow
                    $("#loading").fadeOut();

                    console.log(jqXHR);
                    console.log(textStatus);
                    console.log(errorThrown);
                }
            };

            $.ajax(serviceCall);
        }
